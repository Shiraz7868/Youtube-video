<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Owner's Panel - Captured Images</title>
    <!-- Supabase Library ko import kiya gaya hai -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background-color: #f0f0f0; margin: 0; padding: 20px; }
        h1 { text-align: center; }
        #image-gallery { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
        .img-container { border: 2px solid #ddd; padding: 5px; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        img { max-width: 300px; display: block; }
        p { text-align: center; }
    </style>
</head>
<body>

    <h1>Captured Images Panel (Live)</h1>
    <div id="image-gallery">
        <p>Listening for new images...</p>
    </div>

    <script>
        // <<< AAPKI URL AUR KEY YAHAN BHI ADD KAR DI GAYI HAIN >>>
        const SUPABASE_URL = 'https://zxtapsswwmzrirutpelr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp4dGFwc3N3d216cmlydXRwZWxyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAxNTExNzcsImV4cCI6MjA2NTcyNzE3N30.J6kJ9k0AEAarxHVePl0gZSG6ya32rP7IsG8R6UfuO-U';
        
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const gallery = document.getElementById('image-gallery');

        function displayImage(imageData) {
            if (!imageData) return;
            const imgContainer = document.createElement('div');
            imgContainer.className = 'img-container';
            const imgElement = document.createElement('img');
            imgElement.src = imageData;
            imgContainer.appendChild(imgElement);
            gallery.prepend(imgContainer); // Nayi tasveer sab se upar dikhayein
        }

        async function loadInitialImages() {
            const { data, error } = await supabase
                .from('images')
                .select('image_data')
                .order('created_at', { ascending: false }); // Sab se nayi pehle
            if (error) {
                console.error('Error loading images:', error);
                return;
            }
            gallery.innerHTML = ''; // Loading message ko saaf karein
            data.forEach(item => displayImage(item.image_data));
        }

        // Live naye images ke liye listen karein
        const channel = supabase.channel('any')
            .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'images' }, payload => {
                console.log('New image received!', payload);
                displayImage(payload.new.image_data);
            })
            .subscribe();
        
        // Page load hotay hi purani tasveerein load karein
        loadInitialImages();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Owner's Panel - Captured Images</title>
    <style>
        body { font-family: sans-serif; background-color: #f0f0f0; margin: 0; padding: 20px; }
        h1 { text-align: center; }
        #controls { text-align: center; margin-bottom: 20px; }
        #fetch-button { background-color: #007bff; color: white; border: none; padding: 10px 20px; font-size: 16px; border-radius: 5px; cursor: pointer; }
        #fetch-button:hover { background-color: #0056b3; }
        #image-gallery { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
        .img-container { border: 2px solid #ddd; padding: 5px; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        img { max-width: 300px; display: block; }
        p { text-align: center; }
    </style>
</head>
<body>

    <h1>Captured Images Panel</h1>
    <div id="controls">
        <button id="fetch-button">Fetch Latest Images</button>
    </div>
    <div id="image-gallery">
        <p>Click the button to load images.</p>
    </div>

    <script>
        document.getElementById('fetch-button').addEventListener('click', async () => {
            const gallery = document.getElementById('image-gallery');
            gallery.innerHTML = '<p>Loading...</p>';

            try {
                // We will create this API endpoint next
                const response = await fetch('/api/get-images');
                if (!response.ok) {
                    throw new Error('Failed to fetch images list.');
                }
                const { images } = await response.json();

                gallery.innerHTML = ''; // Clear loading message

                if (images.length === 0) {
                    gallery.innerHTML = '<p>No images found yet.</p>';
                } else {
                    images.forEach(imageFile => {
                        const imgContainer = document.createElement('div');
                        imgContainer.className = 'img-container';

                        const imgElement = document.createElement('img');
                        // Images in /tmp are not directly accessible via URL.
                        // So, we will stream them through another API endpoint.
                        // Let's assume an endpoint /api/image?name=filename
                        // But for Vercel, it's easier to list them and then let the get-images endpoint return them.
                        // Let's modify the plan. get-images will return the image data itself.
                        // For simplicity now, let's assume we get filenames.
                        imgElement.src = `/api/get-images?file=${imageFile}`;
                        
                        imgContainer.appendChild(imgElement);
                        gallery.appendChild(imgContainer);
                    });
                }
            } catch (error) {
                console.error('Error fetching images:', error);
                gallery.innerHTML = `<p>Error: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>